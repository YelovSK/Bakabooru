<div class="hover-preview-overlay pointer-events-none fixed inset-0 z-50 flex items-center justify-center">
    <div class="hover-preview-card pointer-events-auto relative overflow-hidden rounded-2xl border border-white/10 bg-slate-900/95 shadow-[0_32px_64px_rgba(0,0,0,0.6)]"
        data-preview-card (mouseleave)="onCardLeave()" (click)="onClick()" (wheel)="onCardLeave()">

        @switch (getMediaType(post().contentType)) {
        @case ('video') {
        <video [src]="mediaBaseUrl() + post().contentUrl" class="block max-h-[80vh] max-w-[80vw] object-contain"
            autoplay muted loop playsinline>
        </video>
        }
        @default {
        <!--
            Size the container so progressive-image's absolute children fill it correctly.
            We cap at 80vw Ã— 80vh and apply the post's natural aspect ratio.
        -->
        <div class="relative max-h-[80vh] max-w-[80vw]"
            [style.aspect-ratio]="post().width && post().height ? post().width + '/' + post().height : '1/1'"
            [style.width]="post().width && post().height ? 'min(80vw, 80vh * ' + post().width + ' / ' + post().height + ')' : '60vw'">
            <app-progressive-image [thumbnailSrc]="mediaBaseUrl() + post().thumbnailUrl"
                [fullSrc]="mediaBaseUrl() + post().contentUrl" [alt]="'Post ' + post().id"
                [width]="post().width || null" [height]="post().height || null" />
        </div>
        }
        }

        <div class="absolute bottom-0 right-0 left-0 bg-linear-to-t from-black/70 to-transparent px-4 py-3">
            <span class="text-sm font-bold text-white/90">#{{ post().id }}</span>
        </div>
    </div>
</div>