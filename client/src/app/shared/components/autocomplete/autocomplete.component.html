<div class="relative w-full">
  <div class="relative w-full">
    <input #searchInput type="text" [placeholder]="placeholder()" [value]="inputValue()" (input)="onInput($event)"
      (focus)="onFocus()" (keydown)="onKeyDown($event)" autocomplete="off" spellcheck="false"
      class="w-full px-6 py-3 bg-bg-tertiary border border-white/15 rounded-[15px] text-white text-[0.9rem] outline-none transition-all duration-200 box-border focus:border-accent-primary focus:bg-bg-tertiary focus:shadow-[0_0_15px_rgba(56,189,248,0.1)]"
      [class.pr-14]="showClear() || internalLoading()" />

    @if (showClear() && inputValue().length > 0 && !internalLoading()) {
    <button type="button" (click)="clearInput()" tabindex="-1"
      class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 flex items-center justify-center text-text-dim hover:text-white transition-colors duration-150 cursor-pointer bg-transparent border-none p-0">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
        <path
          d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
      </svg>
    </button>
    }

    @if (internalLoading()) {
    <div class="absolute right-4 top-1/2 -translate-y-1/2">
      <div class="w-5 h-5 border-2 border-accent-primary/30 border-t-accent-primary rounded-full animate-spin"></div>
    </div>
    }
  </div>

  @if (isDropdownOpen())
  {
  <ul #suggestionList
    class="absolute top-[calc(100%+8px)] left-0 right-0 bg-bg-tertiary border border-white/10 rounded-[15px] list-none p-2.5 m-0 z-[500] shadow-[0_15px_35px_rgba(0,0,0,0.6)] max-h-[420px] overflow-y-auto box-scrollbar">
    @for (suggestion of suggestions(); track $index) {
    @let isSelected = $index === selectedIndex();
    <li #optionItem (mouseenter)="setSelectedIndex($index)" (click)="selectItem(suggestion)" tabindex="0"
      (keydown.enter)="selectItem(suggestion)" [class.bg-accent-primary/15]="isSelected" [class.border-l-3]="isSelected"
      [class.border-l-accent-primary]="isSelected" [class.pl-[calc(1rem-3px)]]="isSelected"
      [class.selected]="isSelected"
      class="p-2 rounded-[10px] cursor-pointer transition-all duration-150 mb-0.5 last:mb-0 hover:bg-accent-primary/15 hover:text-white">
      @if (itemTemplate(); as template) {
      <ng-container [ngTemplateOutlet]="template" [ngTemplateOutletContext]="{ $implicit: suggestion }"></ng-container>
      } @else {
      <span class="text-text-secondary font-medium">{{ suggestion }}</span>
      }
    </li>
    }
  </ul>
  }
</div>